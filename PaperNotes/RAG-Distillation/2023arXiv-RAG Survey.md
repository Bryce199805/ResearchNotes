# Retrieval-Augmented Generation for Large  Language Models: A Survey



## Retrieval

### Retrieval Source  检索源

#### Data Structure 数据结构

- 非结构化数据（如文本）是最广泛的检索源，主要来自于语料库，针对开放域问答任务主要检索源是Wikipedia Sump；除了维基百科，常用的非结构化数据还包括跨语言文本和特定领域数据（医疗、法律等）
- 半结构化数据，通常指包含文本和表格信息组合的数据，如pdf，半结构化数据有两个挑战：文本拆分过程可能会无意间分离表，导致检索数据损坏；将表格合并到数据中会使语义相似性搜索复杂化。该领域存在大量研究机会
- 结构化数据，例如知识图谱KG，这些数据通常经过验证，可以提供更加精确的信息。他需要额外的工作来构建、验证和维护结构化数据库。
- LLMs生成内容，一些研究聚焦于利用LLMs的内部知识来作为知识来源

#### Retrieval Granularity 检索粒度

粗粒度的检索单元可以为问题提供更相关的信息，但他们也可能包含冗余内容，这可能分散下游任务中检索器和语言模型的注意力；细粒度检索单元粒度增加了检索的负担，并且不能保证语义完整性和满足所需的知识。

在文本任务中，粒度从细到粗分为：token, phrase, sentence, proposition, chunks, document 

在知识图谱KG上，检索粒度包括Entity, Triplet, sub-graph



### Indexing Optimization 索引优化

索引阶段，文档被处理分割并转换为向量存储在矢量数据库中，索引的质量决定了检索阶段是否能得到正确的上下文。

#### Chunking Strategy 分块策略

最常见的方法是将文档拆分为固定数量的块。较大的块可以捕获更多的上下文，但他们也会产生更多的干扰，需要更长的处理时间和更高的成本；较小的块可能无法传达必要的上下文，但他们的噪声较少。

分块会导致句子内的截断，因此促使了优化递归拆分和滑动窗口方法，通过在多个检索过程中合并全局相关信息来实现分层检索。

#### Metadata Attachments 元数据附件

可以用元数据信息（页码、文件名、作者、类别等信息）来丰富块，可以根据此元数据筛选检索，从而限制检索的范围。

除了从原始文档中提取元数据外，还可以人工构建元数据，例如添加段落摘要以及引入假设性问题。

#### Structural Index 结构索引

增强信息检索的一种有效方法是为文档建立层次结构：

- 分层索引结构，file-chunk以父子结构排列，数据摘要存储在每个节点上，有助于快速便利数据帮助RAG系统确定要提取的块
- 知识图谱索引，利用KG构建文档层次结构有助于保持一致性，描绘了不同概念和实体之间的联系



### Query Optimization 查询优化

RAG的主要挑战之一是他直接依赖用户的原始查询作为检索基础，制定一个精确而清晰的问题是困难的。

#### Query Expansion 查询扩充

将单个查询扩展为多个查询可以丰富查询的内容，提供进一步的上下文来解决任何缺少特定细微差别的问题，从而确保生成答案的最佳相关性。

- Multi-Query 多查询，通过采用提示工程通过LLM扩展查询，这些查询可以并行执行，查询的扩展经过精心设计。
- Sub-Query 子查询，子问题规划的过程代表了必要子问题的生成，以便在组合时将原始问题置于上下文中并完全回答，一个复杂的问题可以使用最少到最多提示的方法扩展为一系列更简单的子问题
- Chain-of-Verification(CoVe) 验证链，扩展的查询经过LLM的验证，来减少幻觉的效果，经过验证的扩展查询通常表现出更高的可靠性

#### Query Transformation 查询转换

核心概念是基于转换后的查询而不是用户的原始查询来检索数据块。

- Query Rewrite 查询重写，原始查询并不总是最适合LLM检索的，我们通过提示工程重写查询

#### Query Routing 查询路由

基于不同的查询，路由到不同的RAG管道，来适用不同的场景。

- 元数据路由，第一步涉及从查询中提取关键字，然后根据块中关键字和元数据进行筛选，来缩小检索范围
- 语义路由，利用查询的语义信息



### Embedding 向量模型

RAG检索通过计算问题块和文档快的向量之间的相似性来实现的，向量模型的语义表达能力起着关键作用。

- Mix/hybrid Retrieval 混合检索，为训练密集检索模型提供初始搜索结果，可以使用预训练语言模型来学习术语权重以增强稀疏检索；增强密集检索模型的零样本检索能力
- Fine-tuning Embedding Model 微调向量模型，在上下文明显偏离预训练语料库的情况下，尤其是在高度专业化的学科中，在自己领域的数据集微调向量模型对于减少偏离是至关重要的



### Adapter 适配器

有的方法通过引入适配器的方案来微调检索模型，更好的适应不同的下游任务。
